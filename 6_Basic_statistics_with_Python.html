

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>7. Basic statistics and time series analysis with Python &#8212; Data analytics in accounting</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '6_Basic_statistics_with_Python';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Machine learning for structured data - Classification" href="7.1_ML_for_structured_data-classification.html" />
    <link rel="prev" title="6. Visualisations with Python" href="5_Visualisation_with_Python.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="book_intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="book_intro.html">
                    Introduction to data analytics in accounting
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic data analytics in accounting</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0_installing_Python.html">1. Installing Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Intro_to_Python.html">2. Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_Pandas_basics.html">3. Pandas data basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Pandas_data_preprocessing.html">4. Pandas Data preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Connecting_with_accounting_databases.html">5. Connecting with accounting databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_Visualisation_with_Python.html">6. Visualisations with Python</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">7. Basic statistics and time series analysis with Python</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine learning in accounting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="7.1_ML_for_structured_data-classification.html">8. Machine learning for structured data - Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.2_ML_for_structured_data-regression.html">9. Machine learning for structured data - Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.3_ML_for_structured_data-xgboost_example.html">10. Example - Xgboost, state-of-the-art ensemble method for structured data</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.4_ML_for_structured_data-example.html">11. Example of grid-search</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_Decision_making_in_accounting.html">12. Decision making with ML in accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_Deep_learning_in_accounting.html">13. Deep learning in accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="9.1_Bonus_example.html">14. Bonus example - starting from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="9.2_AccFin_example.html">15. Deep learning example from Accounting/Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_NLP_in_accounting.html">16. Introduction to natural language processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="10.1_LDA_bonus_example.html">17. Basic LDA example - An analysis of ~200 scientific articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="10.2_Advanced_NLP_accfin.html">18. Advanced NLP and Accounting/Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_Neural_NLP_methods.html">19. Neural NLP models</a></li>
<li class="toctree-l1"><a class="reference internal" href="11.1_Neural_NLP_and_accfin.html">20. Neural NLP and accounting/finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="11.2_Transformers_examples.html">21. Transformers examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_BONUS-processing_unstructured_data.html">22. Processing unstructured data</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/6_Basic_statistics_with_Python.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Basic statistics and time series analysis with Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics-with-pandas">7.1. Descriptive statistics with Pandas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#probability-and-statistics-functions">7.2. Probability and statistics functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-analysis-with-statsmodels">7.3. Statistical analysis with statsmodels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-analysis-with-scipy-stats">7.4. Statistical analysis with scipy.stats</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series">7.5. Time series</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datetime">7.5.1. Datetime</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-models">7.5.2. ARIMA models</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="basic-statistics-and-time-series-analysis-with-python">
<h1><span class="section-number">7. </span>Basic statistics and time series analysis with Python<a class="headerlink" href="#basic-statistics-and-time-series-analysis-with-python" title="Permalink to this heading">#</a></h1>
<p>This chapter shortly introduces the methods and libraries Python has to offer for basic statistics and time series analysis.</p>
<p>Let’s start by analysing what kind statistical functions Numpy has to offer. The selection is somewhat limited and usually it is better to use some other libraries for statistical analysis, like Pandas or Statsmodels. However, sometimes you have to use Numpy for data manipulations. For example, if your accounting datasets are very large, Numpy is the most efficient solution in Python. Therefore, it is also useful to know the  basic statistical functions that Numpy has to offer. We will learn more about Numpy in the next chapter. Here we check only the main statistical functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">()</span>
<span class="c1">#plt.style.use(&#39;bmh&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.pyplot._xkcd at 0x1cecc63ed60&gt;
</pre></div>
</div>
</div>
</div>
<p>The following function creates an array of random values from the normal distribution. The mean of the distribution is 0 and the standard deviation (scale) 1. The last parameter (5,3) defines the shape of the array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.88147694, -0.23012054,  0.4697334 ],
       [ 1.20887621, -0.59576469,  2.31689053],
       [ 0.83545298,  0.04339869, -1.03295269],
       [-0.32116686, -0.33231894,  0.25805056],
       [-0.10434287, -1.78014454, -0.43249477]])
</pre></div>
</div>
</div>
</div>
<p>The default is a statistic calculated from the whole array, but you can also define if you want them calculated for rows or colums.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># The mean for the whole array</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.14563822735019785
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># The mean for the columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.70005928, -0.57899   ,  0.31584541])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># The mean for the rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.70702993,  0.97666735, -0.05136701, -0.13181174, -0.77232739])
</pre></div>
</div>
</div>
</div>
<p>Numpy also has the function to calculate the sum of the values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.184573410252968
</pre></div>
</div>
</div>
</div>
<p>Standard deviation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0358116382691998
</pre></div>
</div>
</div>
</div>
<p><em>argmin</em> and <em>argmax</em> return the position of the minimum and maximum value. By default, <em>argmin</em> and <em>argmax</em> return the index of a flattened array (transformed to one dimension). You can also define the axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="c1"># The position of the smallest value.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># The position of the largest value in columns.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3, 4, 2], dtype=int64)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># The position of the largest value in rows.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1, 1, 2, 1, 1], dtype=int64)
</pre></div>
</div>
</div>
</div>
<p>Cumulative sum of the array. <strong>cumsum()</strong> also flattens arrays by default.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array_np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.88147694, 1.65135639, 2.1210898 , 3.32996601, 2.73420132,
       5.05109185, 5.88654483, 5.92994352, 4.89699082, 4.57582397,
       4.24350503, 4.50155559, 4.39721272, 2.61706818, 2.18457341])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">array_np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7300de27f80cdd14842a7e5fb4b8e88d19db9505bb0355351c52fbdd315cbcfa.png" src="_images/7300de27f80cdd14842a7e5fb4b8e88d19db9505bb0355351c52fbdd315cbcfa.png" />
</div>
</div>
<section id="descriptive-statistics-with-pandas">
<h2><span class="section-number">7.1. </span>Descriptive statistics with Pandas<a class="headerlink" href="#descriptive-statistics-with-pandas" title="Permalink to this heading">#</a></h2>
<p>Pandas is much more versatile for statistical calculations than Numpy, and should be used if there is no specific reason to use Numpy. Let’s load a more interesting dataset to analyse.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;stat_data.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAME</th>
      <th>DIV. YIELD</th>
      <th>ROE (%)</th>
      <th>R&amp;D/SALES (%)</th>
      <th>CoGS/SALES - 5 Y (%)</th>
      <th>SG%A/SALES 5Y (%)</th>
      <th>ACCOUNTING STANDARD</th>
      <th>Accounting Controversies</th>
      <th>Basis of EPS data</th>
      <th>INDUSTRY GROUP</th>
      <th>IBES COUNTRY CODE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>APPLE</td>
      <td>0.71</td>
      <td>55.92</td>
      <td>4.95</td>
      <td>56.64</td>
      <td>6.53</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>4030.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SAUDI ARABIAN OIL</td>
      <td>0.21</td>
      <td>32.25</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IFRS</td>
      <td>N</td>
      <td>EPS</td>
      <td>5880.0</td>
      <td>FW</td>
    </tr>
    <tr>
      <th>2</th>
      <td>MICROSOFT</td>
      <td>1.07</td>
      <td>40.14</td>
      <td>13.59</td>
      <td>26.46</td>
      <td>19.56</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>4080.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AMAZON.COM</td>
      <td>0.00</td>
      <td>21.95</td>
      <td>12.29</td>
      <td>56.82</td>
      <td>21.28</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>7091.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FACEBOOK CLASS A</td>
      <td>0.00</td>
      <td>19.96</td>
      <td>21.00</td>
      <td>7.06</td>
      <td>20.42</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>8580.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>295</th>
      <td>BHP GROUP</td>
      <td>4.23</td>
      <td>16.61</td>
      <td>NaN</td>
      <td>45.50</td>
      <td>NaN</td>
      <td>IFRS</td>
      <td>N</td>
      <td>IFRS</td>
      <td>5210.0</td>
      <td>EX</td>
    </tr>
    <tr>
      <th>296</th>
      <td>CITIC SECURITIES 'A'</td>
      <td>1.67</td>
      <td>7.77</td>
      <td>NaN</td>
      <td>10.91</td>
      <td>27.44</td>
      <td>IFRS</td>
      <td>N</td>
      <td>EPS</td>
      <td>4395.0</td>
      <td>FC</td>
    </tr>
    <tr>
      <th>297</th>
      <td>EDWARDS LIFESCIENCES</td>
      <td>0.00</td>
      <td>28.73</td>
      <td>16.09</td>
      <td>23.33</td>
      <td>30.22</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>3440.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>298</th>
      <td>GREE ELECT.APP. 'A'</td>
      <td>2.25</td>
      <td>24.52</td>
      <td>NaN</td>
      <td>66.35</td>
      <td>14.94</td>
      <td>Local standards</td>
      <td>N</td>
      <td>EPS</td>
      <td>3720.0</td>
      <td>FC</td>
    </tr>
    <tr>
      <th>299</th>
      <td>HOUSING DEVELOPMENT FINANCE CORPORATION</td>
      <td>1.08</td>
      <td>18.17</td>
      <td>NaN</td>
      <td>4.74</td>
      <td>23.90</td>
      <td>Local standards</td>
      <td>N</td>
      <td>EPS</td>
      <td>4390.0</td>
      <td>FI</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Set the NAME variable as index of the dataframe</span>
</pre></div>
</div>
</div>
</div>
<p>Usually, the default setting with the Pandas statistical functions is that they calculate column statistics. For example, here is the <strong>sum</strong> function (does not make much sense here).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                  695.563
ROE (%)                   40278.820
R&amp;D/SALES (%)              1368.340
CoGS/SALES - 5 Y (%)      11247.840
SG%A/SALES 5Y (%)          5384.550
INDUSTRY GROUP          1521606.000
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>With <strong>axis=1</strong>, you can calculate also row-sums.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NAME
APPLE                                      4154.75
SAUDI ARABIAN OIL                          5912.46
MICROSOFT                                  4180.82
AMAZON.COM                                 7203.34
FACEBOOK CLASS A                           8648.44
                                            ...   
BHP GROUP                                  5276.34
CITIC SECURITIES &#39;A&#39;                       4442.79
EDWARDS LIFESCIENCES                       3538.37
GREE ELECT.APP. &#39;A&#39;                        3828.06
HOUSING DEVELOPMENT FINANCE CORPORATION    4437.89
Length: 300, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>There is also a cumulative sum similar to Numpy’s equivalent. Notice that it calculates the cumulative sum series for columns by default.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="p">[[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">,</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DIV. YIELD</th>
      <th>ROE (%)</th>
    </tr>
    <tr>
      <th>NAME</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>APPLE</th>
      <td>0.710</td>
      <td>55.92</td>
    </tr>
    <tr>
      <th>SAUDI ARABIAN OIL</th>
      <td>0.920</td>
      <td>88.17</td>
    </tr>
    <tr>
      <th>MICROSOFT</th>
      <td>1.990</td>
      <td>128.31</td>
    </tr>
    <tr>
      <th>AMAZON.COM</th>
      <td>1.990</td>
      <td>150.26</td>
    </tr>
    <tr>
      <th>FACEBOOK CLASS A</th>
      <td>1.990</td>
      <td>170.22</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>BHP GROUP</th>
      <td>690.563</td>
      <td>40199.63</td>
    </tr>
    <tr>
      <th>CITIC SECURITIES 'A'</th>
      <td>692.233</td>
      <td>40207.40</td>
    </tr>
    <tr>
      <th>EDWARDS LIFESCIENCES</th>
      <td>692.233</td>
      <td>40236.13</td>
    </tr>
    <tr>
      <th>GREE ELECT.APP. 'A'</th>
      <td>694.483</td>
      <td>40260.65</td>
    </tr>
    <tr>
      <th>HOUSING DEVELOPMENT FINANCE CORPORATION</th>
      <td>695.563</td>
      <td>40278.82</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 2 columns</p>
</div></div></div>
</div>
<p>The mean value of the columns. Notice how non-numerical columns are automatically excluded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                 2.318543
ROE (%)                  138.415189
R&amp;D/SALES (%)              8.096686
CoGS/SALES - 5 Y (%)      44.109176
SG%A/SALES 5Y (%)         22.815890
INDUSTRY GROUP          5088.983278
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>By default, NA values are excluded. You can prevent that using <strong>skipna=False</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD              2.318543
ROE (%)                      NaN
R&amp;D/SALES (%)                NaN
CoGS/SALES - 5 Y (%)         NaN
SG%A/SALES 5Y (%)            NaN
INDUSTRY GROUP               NaN
dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>idxmin</strong> and <strong>idxmax</strong> can be used to locate the maximum and minimum values along the specified axis. It does not work with string-values, so we restrict the columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="p">[[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">,</span> <span class="s1">&#39;ROE (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;R&amp;D/SALES (%)&#39;</span><span class="p">,</span>
       <span class="s1">&#39;CoGS/SALES - 5 Y (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;SG%A/SALES 5Y (%)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                               BP
ROE (%)                       COLGATE-PALM.
R&amp;D/SALES (%)                VERTEX PHARMS.
CoGS/SALES - 5 Y (%)    CHINA PTL.&amp; CHM.&#39;A&#39;
SG%A/SALES 5Y (%)       SEA &#39;A&#39; SPN.ADR 1:1
dtype: object
</pre></div>
</div>
</div>
</div>
<p><strong>Describe()</strong> is the main tool for descriptive statistics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DIV. YIELD</th>
      <th>ROE (%)</th>
      <th>R&amp;D/SALES (%)</th>
      <th>CoGS/SALES - 5 Y (%)</th>
      <th>SG%A/SALES 5Y (%)</th>
      <th>INDUSTRY GROUP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>300.000000</td>
      <td>291.000000</td>
      <td>169.000000</td>
      <td>255.000000</td>
      <td>236.000000</td>
      <td>299.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.318543</td>
      <td>138.415189</td>
      <td>8.096686</td>
      <td>44.109176</td>
      <td>22.815890</td>
      <td>5088.983278</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.357387</td>
      <td>1850.606330</td>
      <td>8.510284</td>
      <td>21.754619</td>
      <td>14.707107</td>
      <td>2079.357337</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>-318.250000</td>
      <td>0.070000</td>
      <td>0.000000</td>
      <td>0.800000</td>
      <td>1320.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.580000</td>
      <td>9.345000</td>
      <td>1.700000</td>
      <td>27.620000</td>
      <td>11.675000</td>
      <td>3440.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.665000</td>
      <td>16.460000</td>
      <td>4.950000</td>
      <td>45.380000</td>
      <td>20.950000</td>
      <td>4370.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.287500</td>
      <td>27.415000</td>
      <td>12.790000</td>
      <td>60.520000</td>
      <td>30.167500</td>
      <td>7030.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>13.130000</td>
      <td>31560.000000</td>
      <td>59.980000</td>
      <td>87.170000</td>
      <td>89.880000</td>
      <td>8592.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can also use <strong>describe</strong> for string-data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;ACCOUNTING STANDARD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count                     297
unique                      3
top       US standards (GAAP)
freq                      160
Name: ACCOUNTING STANDARD, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Quick histograms are easy to draw with Pandas <strong>hist()</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/30f10ed457498c1eae664ed77a195835c558ca346940fb7791a664729ea34db2.png" src="_images/30f10ed457498c1eae664ed77a195835c558ca346940fb7791a664729ea34db2.png" />
</div>
</div>
<p>It is also easy to draw bar plots, line plots, etc. from variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">][</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aebe12cfd2b19fcd7e0c20545c9e53864d11d2987d629c80df482451e981a022.png" src="_images/aebe12cfd2b19fcd7e0c20545c9e53864d11d2987d629c80df482451e981a022.png" />
</div>
</div>
<p>Pandas also has functions for quantiles, median, mean absolute deviation, variance, st. dev., skewness, kurtosis etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                 1.665
ROE (%)                   16.460
R&amp;D/SALES (%)              4.950
CoGS/SALES - 5 Y (%)      45.380
SG%A/SALES 5Y (%)         20.950
INDUSTRY GROUP          4370.000
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                 2.357387
ROE (%)                 1850.606330
R&amp;D/SALES (%)              8.510284
CoGS/SALES - 5 Y (%)      21.754619
SG%A/SALES 5Y (%)         14.707107
INDUSTRY GROUP          2079.357337
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD               1.613739
ROE (%)                 16.995965
R&amp;D/SALES (%)            2.052940
CoGS/SALES - 5 Y (%)    -0.023779
SG%A/SALES 5Y (%)        1.282915
INDUSTRY GROUP           0.433038
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">kurt</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                3.045584
ROE (%)                 289.548386
R&amp;D/SALES (%)             7.757465
CoGS/SALES - 5 Y (%)     -0.895532
SG%A/SALES 5Y (%)         2.793218
INDUSTRY GROUP           -1.026390
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">mad</span><span class="p">()</span> <span class="c1"># Mean absolute deviation</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIV. YIELD                 1.754535
ROE (%)                  232.701188
R&amp;D/SALES (%)              6.541208
CoGS/SALES - 5 Y (%)      18.349461
SG%A/SALES 5Y (%)         11.128403
INDUSTRY GROUP          1787.992573
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>There are also functions for first differences (<strong>diff</strong>) and percentage changes (<strong>pct_change</strong>) that are useful for time series. We check them more closely when we discuss time series.</p>
<p>A correlation matrix can be calculated with <strong>corr()</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DIV. YIELD</th>
      <th>ROE (%)</th>
      <th>R&amp;D/SALES (%)</th>
      <th>CoGS/SALES - 5 Y (%)</th>
      <th>SG%A/SALES 5Y (%)</th>
      <th>INDUSTRY GROUP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DIV. YIELD</th>
      <td>1.000000</td>
      <td>-0.005395</td>
      <td>-0.296876</td>
      <td>0.090552</td>
      <td>-0.246277</td>
      <td>0.020287</td>
    </tr>
    <tr>
      <th>ROE (%)</th>
      <td>-0.005395</td>
      <td>1.000000</td>
      <td>-0.059943</td>
      <td>-0.018829</td>
      <td>0.037760</td>
      <td>-0.051351</td>
    </tr>
    <tr>
      <th>R&amp;D/SALES (%)</th>
      <td>-0.296876</td>
      <td>-0.059943</td>
      <td>1.000000</td>
      <td>-0.525651</td>
      <td>0.243388</td>
      <td>-0.076826</td>
    </tr>
    <tr>
      <th>CoGS/SALES - 5 Y (%)</th>
      <td>0.090552</td>
      <td>-0.018829</td>
      <td>-0.525651</td>
      <td>1.000000</td>
      <td>-0.478954</td>
      <td>-0.069946</td>
    </tr>
    <tr>
      <th>SG%A/SALES 5Y (%)</th>
      <td>-0.246277</td>
      <td>0.037760</td>
      <td>0.243388</td>
      <td>-0.478954</td>
      <td>1.000000</td>
      <td>0.169234</td>
    </tr>
    <tr>
      <th>INDUSTRY GROUP</th>
      <td>0.020287</td>
      <td>-0.051351</td>
      <td>-0.076826</td>
      <td>-0.069946</td>
      <td>0.169234</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Seaborn can be used to visualise the correlation matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">stat_df</span><span class="o">.</span><span class="n">corr</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/928164e9c684f5c27e931c3af94d7ef84f464642da23196ca473871e23000a31.png" src="_images/928164e9c684f5c27e931c3af94d7ef84f464642da23196ca473871e23000a31.png" />
</div>
</div>
<p>There is also a function for covariance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DIV. YIELD</th>
      <th>ROE (%)</th>
      <th>R&amp;D/SALES (%)</th>
      <th>CoGS/SALES - 5 Y (%)</th>
      <th>SG%A/SALES 5Y (%)</th>
      <th>INDUSTRY GROUP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DIV. YIELD</th>
      <td>5.557272</td>
      <td>-2.353205e+01</td>
      <td>-6.218173</td>
      <td>4.458371</td>
      <td>-8.101883</td>
      <td>9.944971e+01</td>
    </tr>
    <tr>
      <th>ROE (%)</th>
      <td>-23.532053</td>
      <td>3.424744e+06</td>
      <td>-1230.260093</td>
      <td>-815.944421</td>
      <td>1151.251649</td>
      <td>-1.970465e+05</td>
    </tr>
    <tr>
      <th>R&amp;D/SALES (%)</th>
      <td>-6.218173</td>
      <td>-1.230260e+03</td>
      <td>72.424937</td>
      <td>-93.699026</td>
      <td>30.348468</td>
      <td>-1.296751e+03</td>
    </tr>
    <tr>
      <th>CoGS/SALES - 5 Y (%)</th>
      <td>4.458371</td>
      <td>-8.159444e+02</td>
      <td>-93.699026</td>
      <td>473.263467</td>
      <td>-152.229721</td>
      <td>-3.340919e+03</td>
    </tr>
    <tr>
      <th>SG%A/SALES 5Y (%)</th>
      <td>-8.101883</td>
      <td>1.151252e+03</td>
      <td>30.348468</td>
      <td>-152.229721</td>
      <td>216.298997</td>
      <td>5.397233e+03</td>
    </tr>
    <tr>
      <th>INDUSTRY GROUP</th>
      <td>99.449713</td>
      <td>-1.970465e+05</td>
      <td>-1296.750542</td>
      <td>-3340.919268</td>
      <td>5397.233215</td>
      <td>4.323727e+06</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If you want to calculate correlations between two dataframes, you can use <strong>corr_with()</strong>.</p>
<p>To collect the unique values of a Pandas series, you can use <strong>unique()</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;IBES COUNTRY CODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;  US&#39;, &#39;  FW&#39;, &#39;  FH&#39;, &#39;  FA&#39;, &#39;  ES&#39;, &#39;  FC&#39;, &#39;  FK&#39;, &#39;  EF&#39;,
       &#39;  FJ&#39;, &#39;  ED&#39;, &#39;  FI&#39;, &#39;  EN&#39;, &#39;  EX&#39;, &#39;  EZ&#39;, &#39;  SD&#39;, &#39;  CN&#39;,
       &#39;  EI&#39;, &#39;  EB&#39;, &#39;  AA&#39;, &#39;  EE&#39;, &#39;  KS&#39;, nan, &#39;  LB&#39;, &#39;  ER&#39;,
       &#39;  SN&#39;, &#39;  LA&#39;, &#39;  SS&#39;, &#39;  FL&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p><strong>value_counts</strong> can be used to collect frequencies of values. Here the counts are presented as a bar chart. Notice how we chain dataframe functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;IBES COUNTRY CODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f19d5d27c516e8b5cab93bd2afa22ba716544df17929b8fed96fe8652c4101c0.png" src="_images/f19d5d27c516e8b5cab93bd2afa22ba716544df17929b8fed96fe8652c4101c0.png" />
</div>
</div>
</section>
<section id="probability-and-statistics-functions">
<h2><span class="section-number">7.2. </span>Probability and statistics functions<a class="headerlink" href="#probability-and-statistics-functions" title="Permalink to this heading">#</a></h2>
<p>What we mainly need in data analysis from probability theory are random variables and distributions. Numpy has a large collection of random number generators that are located in module <strong>numpy.random</strong>. There are random number generators for every distribution that you will ever need.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> <span class="c1"># Create 500 normal random variables with *mean=0* and *std=1*</span>
<span class="n">y_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">x_np</span><span class="p">,</span><span class="n">y_np</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># Visualise the joint frequency distribution using 2D-histogram.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16e6bbef47a600c63fd9b27d7708d7e9d228b2ba1e2bb2320d45266e2c04256b.png" src="_images/16e6bbef47a600c63fd9b27d7708d7e9d228b2ba1e2bb2320d45266e2c04256b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyper_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">hypergeometric</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hyper_np</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[6, 5, 7],
       [7, 4, 6],
       [6, 4, 5]])
</pre></div>
</div>
</div>
</div>
<p>Probably the most important distributions are the standard normal distribution, the chi2 distribution and the binomial distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cdfed4d0d9ae5d6e82b239b5cd22a6435417a58d5866d8e255e02935aed78124.png" src="_images/cdfed4d0d9ae5d6e82b239b5cd22a6435417a58d5866d8e255e02935aed78124.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">chisquare</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/485f93da1970cbea961e4017f3e22b406b9a2fe6e45fa459a45d1f675ec632bb.png" src="_images/485f93da1970cbea961e4017f3e22b406b9a2fe6e45fa459a45d1f675ec632bb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">chisquare</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4077ac07705cf44e64a3ac2adafe3f1c9a3cf2ad9b6ab5d14fa8109885e94d5e.png" src="_images/4077ac07705cf44e64a3ac2adafe3f1c9a3cf2ad9b6ab5d14fa8109885e94d5e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bf3cf95c172ba3f156107ed4b90abbe482198dbbc69a0d1809c4afadea345212.png" src="_images/bf3cf95c172ba3f156107ed4b90abbe482198dbbc69a0d1809c4afadea345212.png" />
</div>
</div>
<p>It is good to remember that computer-generated random numbers are not truly random numbers. They are so called pseudorandom numbers. It is because they are generated using a deterministic algorithm and a seed value.</p>
</section>
<section id="statistical-analysis-with-statsmodels">
<h2><span class="section-number">7.3. </span>Statistical analysis with statsmodels<a class="headerlink" href="#statistical-analysis-with-statsmodels" title="Permalink to this heading">#</a></h2>
<p>Pandas (and Numpy) has only functions for basic statistical analysis, like descriptive statistics. If you want to do more advanced (traditional) statistical analysis, the <strong>statsmodels</strong> library is a good option.</p>
<p>For example, linear regerssion models are very easy to build with <strong>statsmodels</strong>. Let’s model the dividend yield as a function of the R&amp;D intensity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<p>Remove the missing values of the endogenous variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stat_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;DIV. YIELD&#39;, &#39;ROE (%)&#39;, &#39;R&amp;D/SALES (%)&#39;, &#39;CoGS/SALES - 5 Y (%)&#39;,
       &#39;SG%A/SALES 5Y (%)&#39;, &#39;ACCOUNTING STANDARD&#39;, &#39;Accounting Controversies&#39;,
       &#39;Basis of EPS data&#39;, &#39;INDUSTRY GROUP&#39;, &#39;IBES COUNTRY CODE&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span> <span class="o">=</span> <span class="n">stat_df</span><span class="p">[</span><span class="o">~</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DIV. YIELD</th>
      <th>ROE (%)</th>
      <th>R&amp;D/SALES (%)</th>
      <th>CoGS/SALES - 5 Y (%)</th>
      <th>SG%A/SALES 5Y (%)</th>
      <th>ACCOUNTING STANDARD</th>
      <th>Accounting Controversies</th>
      <th>Basis of EPS data</th>
      <th>INDUSTRY GROUP</th>
      <th>IBES COUNTRY CODE</th>
    </tr>
    <tr>
      <th>NAME</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>APPLE</th>
      <td>0.71</td>
      <td>55.92</td>
      <td>4.95</td>
      <td>56.64</td>
      <td>6.53</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>4030.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>SAUDI ARABIAN OIL</th>
      <td>0.21</td>
      <td>32.25</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IFRS</td>
      <td>N</td>
      <td>EPS</td>
      <td>5880.0</td>
      <td>FW</td>
    </tr>
    <tr>
      <th>MICROSOFT</th>
      <td>1.07</td>
      <td>40.14</td>
      <td>13.59</td>
      <td>26.46</td>
      <td>19.56</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>4080.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>AMAZON.COM</th>
      <td>0.00</td>
      <td>21.95</td>
      <td>12.29</td>
      <td>56.82</td>
      <td>21.28</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>7091.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>FACEBOOK CLASS A</th>
      <td>0.00</td>
      <td>19.96</td>
      <td>21.00</td>
      <td>7.06</td>
      <td>20.42</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>8580.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>BHP GROUP</th>
      <td>4.23</td>
      <td>16.61</td>
      <td>NaN</td>
      <td>45.50</td>
      <td>NaN</td>
      <td>IFRS</td>
      <td>N</td>
      <td>IFRS</td>
      <td>5210.0</td>
      <td>EX</td>
    </tr>
    <tr>
      <th>CITIC SECURITIES 'A'</th>
      <td>1.67</td>
      <td>7.77</td>
      <td>NaN</td>
      <td>10.91</td>
      <td>27.44</td>
      <td>IFRS</td>
      <td>N</td>
      <td>EPS</td>
      <td>4395.0</td>
      <td>FC</td>
    </tr>
    <tr>
      <th>EDWARDS LIFESCIENCES</th>
      <td>0.00</td>
      <td>28.73</td>
      <td>16.09</td>
      <td>23.33</td>
      <td>30.22</td>
      <td>US standards (GAAP)</td>
      <td>N</td>
      <td>NaN</td>
      <td>3440.0</td>
      <td>US</td>
    </tr>
    <tr>
      <th>GREE ELECT.APP. 'A'</th>
      <td>2.25</td>
      <td>24.52</td>
      <td>NaN</td>
      <td>66.35</td>
      <td>14.94</td>
      <td>Local standards</td>
      <td>N</td>
      <td>EPS</td>
      <td>3720.0</td>
      <td>FC</td>
    </tr>
    <tr>
      <th>HOUSING DEVELOPMENT FINANCE CORPORATION</th>
      <td>1.08</td>
      <td>18.17</td>
      <td>NaN</td>
      <td>4.74</td>
      <td>23.90</td>
      <td>Local standards</td>
      <td>N</td>
      <td>EPS</td>
      <td>4390.0</td>
      <td>FI</td>
    </tr>
  </tbody>
</table>
<p>300 rows × 10 columns</p>
</div></div></div>
</div>
<p>One curiosity with statsmodels is that you need to add constant to the x-variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;R&amp;D/SALES (%)&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">,</span><span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The parameters and t-values of the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>const            2.987641
R&amp;D/SALES (%)   -0.085857
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">tvalues</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>const            11.920297
R&amp;D/SALES (%)    -4.017612
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>With <strong>summary()</strong>, you can output all the key regression results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>DIV. YIELD</td>    <th>  R-squared:         </th> <td>   0.088</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.083</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   16.14</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 02 Mar 2021</td> <th>  Prob (F-statistic):</th> <td>8.87e-05</td>
</tr>
<tr>
  <th>Time:</th>                 <td>10:59:21</td>     <th>  Log-Likelihood:    </th> <td> -383.71</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   169</td>      <th>  AIC:               </th> <td>   771.4</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   167</td>      <th>  BIC:               </th> <td>   777.7</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>         <td>    2.9876</td> <td>    0.251</td> <td>   11.920</td> <td> 0.000</td> <td>    2.493</td> <td>    3.482</td>
</tr>
<tr>
  <th>R&D/SALES (%)</th> <td>   -0.0859</td> <td>    0.021</td> <td>   -4.018</td> <td> 0.000</td> <td>   -0.128</td> <td>   -0.044</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>55.164</td> <th>  Durbin-Watson:     </th> <td>   2.035</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 111.976</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 1.519</td> <th>  Prob(JB):          </th> <td>4.84e-25</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 5.583</td> <th>  Cond. No.          </th> <td>    16.3</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary2</span><span class="p">()</span> <span class="c1"># Different format for the results.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
        <td>Model:</td>               <td>OLS</td>         <td>Adj. R-squared:</td>     <td>0.083</td> 
</tr>
<tr>
  <td>Dependent Variable:</td>    <td>DIV. YIELD</td>           <td>AIC:</td>         <td>771.4227</td>
</tr>
<tr>
         <td>Date:</td>        <td>2021-03-02 10:59</td>        <td>BIC:</td>         <td>777.6824</td>
</tr>
<tr>
   <td>No. Observations:</td>         <td>169</td>         <td>Log-Likelihood:</td>    <td>-383.71</td>
</tr>
<tr>
       <td>Df Model:</td>              <td>1</td>           <td>F-statistic:</td>       <td>16.14</td> 
</tr>
<tr>
     <td>Df Residuals:</td>           <td>167</td>       <td>Prob (F-statistic):</td> <td>8.87e-05</td>
</tr>
<tr>
      <td>R-squared:</td>            <td>0.088</td>            <td>Scale:</td>         <td>5.5566</td> 
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>         <th>Coef.</th>  <th>Std.Err.</th>    <th>t</th>     <th>P>|t|</th> <th>[0.025</th>  <th>0.975]</th> 
</tr>
<tr>
  <th>const</th>         <td>2.9876</td>   <td>0.2506</td>  <td>11.9203</td> <td>0.0000</td> <td>2.4928</td>  <td>3.4825</td> 
</tr>
<tr>
  <th>R&D/SALES (%)</th> <td>-0.0859</td>  <td>0.0214</td>  <td>-4.0176</td> <td>0.0001</td> <td>-0.1280</td> <td>-0.0437</td>
</tr>
</table>
<table class="simpletable">
<tr>
     <td>Omnibus:</td>    <td>55.164</td>  <td>Durbin-Watson:</td>    <td>2.035</td> 
</tr>
<tr>
  <td>Prob(Omnibus):</td>  <td>0.000</td> <td>Jarque-Bera (JB):</td> <td>111.976</td>
</tr>
<tr>
       <td>Skew:</td>      <td>1.519</td>     <td>Prob(JB):</td>      <td>0.000</td> 
</tr>
<tr>
     <td>Kurtosis:</td>    <td>5.583</td>  <td>Condition No.:</td>     <td>16</td>   
</tr>
</table></div></div>
</div>
<p><strong>Regplot</strong> can be usd to plot the model over observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;R&amp;D/SALES (%)&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">reduced_df</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/23211efac9081ae39ee5f005136bd36d44d50cd87f6e924ce08b513531b3648a.png" src="_images/23211efac9081ae39ee5f005136bd36d44d50cd87f6e924ce08b513531b3648a.png" />
</div>
</div>
<p>It is easy to add dummy-variables to your model using the Pandas <strong>get_dummes()</strong> -function. For more than two categories, it creates more than one dummmy-variables.</p>
<p>Create a new variable <strong>acc_dummy</strong> that has a value one if the company has accounting controversies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;acc_dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;Accounting Controversies&#39;</span><span class="p">],</span><span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">reduced_df</span><span class="p">[[</span><span class="s1">&#39;R&amp;D/SALES (%)&#39;</span><span class="p">,</span><span class="s1">&#39;acc_dummy&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s chance also the dependent  variable to <strong>ROE</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">,</span><span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>ROE (%)</td>     <th>  R-squared:         </th> <td>   0.004</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>  -0.008</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>  0.3493</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 02 Mar 2021</td> <th>  Prob (F-statistic):</th>  <td> 0.706</td> 
</tr>
<tr>
  <th>Time:</th>                 <td>10:59:26</td>     <th>  Log-Likelihood:    </th> <td> -1521.4</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   165</td>      <th>  AIC:               </th> <td>   3049.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   162</td>      <th>  BIC:               </th> <td>   3058.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>         <td>  386.3556</td> <td>  273.551</td> <td>    1.412</td> <td> 0.160</td> <td> -153.830</td> <td>  926.542</td>
</tr>
<tr>
  <th>R&D/SALES (%)</th> <td>  -18.6428</td> <td>   23.255</td> <td>   -0.802</td> <td> 0.424</td> <td>  -64.564</td> <td>   27.279</td>
</tr>
<tr>
  <th>acc_dummy</th>     <td> -324.4416</td> <td>  960.810</td> <td>   -0.338</td> <td> 0.736</td> <td>-2221.768</td> <td> 1572.885</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>359.716</td> <th>  Durbin-Watson:     </th>  <td>   2.010</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>176047.571</td>
</tr>
<tr>
  <th>Skew:</th>          <td>12.611</td>  <th>  Prob(JB):          </th>  <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>      <td>161.021</td> <th>  Cond. No.          </th>  <td>    57.9</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>As you can see, there is something wrong. If you observed the histograms carefully, you’d seen that there is a clear outlier in <strong>ROE</strong> values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/6b5969055749fec3d66fb0b1215d27d22737f2b6f667671f48d1b35abb8393a6.png" src="_images/6b5969055749fec3d66fb0b1215d27d22737f2b6f667671f48d1b35abb8393a6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count      291.000000
mean       138.415189
std       1850.606330
min       -318.250000
25%          9.345000
50%         16.460000
75%         27.415000
max      31560.000000
Name: ROE (%), dtype: float64
</pre></div>
</div>
</div>
</div>
<p>A maximum value of 31560! We can remove it, or we can winsorise the data. Let’s winsorise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span> <span class="o">=</span> <span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.025</span><span class="p">),</span>
                           <span class="n">upper</span> <span class="o">=</span> <span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.975</span><span class="p">),</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/71beaa5974a8656117cc49520e4f382ef09bc1921bc50a40556a7b1d0a01fdb0.png" src="_images/71beaa5974a8656117cc49520e4f382ef09bc1921bc50a40556a7b1d0a01fdb0.png" />
</div>
</div>
<p>Let’s try to build the regression model again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">reduced_df</span><span class="p">[[</span><span class="s1">&#39;R&amp;D/SALES (%)&#39;</span><span class="p">,</span><span class="s1">&#39;acc_dummy&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">reduced_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">,</span><span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>ROE (%)</td>     <th>  R-squared:         </th> <td>   0.016</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.004</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   1.307</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 02 Mar 2021</td> <th>  Prob (F-statistic):</th>  <td> 0.273</td> 
</tr>
<tr>
  <th>Time:</th>                 <td>10:59:31</td>     <th>  Log-Likelihood:    </th> <td> -801.47</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   165</td>      <th>  AIC:               </th> <td>   1609.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   162</td>      <th>  BIC:               </th> <td>   1618.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>         <td>   24.0008</td> <td>    3.485</td> <td>    6.888</td> <td> 0.000</td> <td>   17.120</td> <td>   30.882</td>
</tr>
<tr>
  <th>R&D/SALES (%)</th> <td>    0.2424</td> <td>    0.296</td> <td>    0.818</td> <td> 0.414</td> <td>   -0.343</td> <td>    0.827</td>
</tr>
<tr>
  <th>acc_dummy</th>     <td>  -15.6371</td> <td>   12.239</td> <td>   -1.278</td> <td> 0.203</td> <td>  -39.807</td> <td>    8.532</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>113.723</td> <th>  Durbin-Watson:     </th> <td>   2.167</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td> 671.865</td> 
</tr>
<tr>
  <th>Skew:</th>          <td> 2.677</td>  <th>  Prob(JB):          </th> <td>1.28e-146</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td>11.310</td>  <th>  Cond. No.          </th> <td>    57.9</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>Although accounting controversies has a negative coefficient, it is not statisticall significant.</p>
<p>Statsmodels is a very comprehensive statistical library. It has modules for nonparametric statistics, generalised linear models, robust regression and time series analysis. We do not go into more details of Statsmodels at this point. If you want to learn more, check the Statsmodels documentation: <a class="reference external" href="https://www.statsmodels.org/stable/index.html">www.statsmodels.org/stable/index.html</a></p>
</section>
<section id="statistical-analysis-with-scipy-stats">
<h2><span class="section-number">7.4. </span>Statistical analysis with scipy.stats<a class="headerlink" href="#statistical-analysis-with-scipy-stats" title="Permalink to this heading">#</a></h2>
<p>Another option for statistical analysis in Python is the <strong>stats</strong> module of <strong>Scipy</strong>. It has many functions that are not included in other statistical libraries. However, Scipy does not handle automatically nan-values. Accounting data almost always has missing values, thus, they need to be manually handled, which is a bit annoying.</p>
<p>Like Numpy, it has an extensive range of random number generators and probability distributions. It also has a long list of statistical tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">ss</span>
</pre></div>
</div>
</div>
</div>
<p>In SciPy, random variables with different distributions are presented as classes, which have methods for random number generation, computing the PDF, CDF and inverse CDF, fitting parameters and computing moments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_rv</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Expected value</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_rv</span><span class="o">.</span><span class="n">expect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0000000000000002
</pre></div>
</div>
</div>
</div>
<p>The value of probability distribution function at 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.10798193302637613
</pre></div>
</div>
</div>
</div>
<p>The value of cumulative distribution function at 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
</div>
</div>
<p>Standard deviation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">norm_rv</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
</div>
</div>
<p>The visualisation of the pdf and cdf of the RV.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">),[</span><span class="n">norm_rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">),[</span><span class="n">norm_rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">)],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1724264fa3b2d04d73d44a38f8377ebe7df87f1c88632248f734f25a5cb7696f.png" src="_images/1724264fa3b2d04d73d44a38f8377ebe7df87f1c88632248f734f25a5cb7696f.png" />
</div>
</div>
<p>The list of distributions in Scipy is long. Here you can read more about them: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/stats.html">docs.scipy.org/doc/scipy/reference/stats.html</a></p>
<p>There are many functions for descriptive statistics. The full list can be found also from the link above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DescribeResult(nobs=300, minmax=(0.0, 13.13), mean=2.3185433333333334, variance=5.557272148617614, skewness=1.6056590920933027, kurtosis=2.975127168101123)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">],</span><span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">)</span> <span class="c1"># Omit missing values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DescribeResult(nobs=291, minmax=(masked_array(data=-318.25,
             mask=False,
       fill_value=1e+20), masked_array(data=31560.,
             mask=False,
       fill_value=1e+20)), mean=138.41518900343644, variance=3424743.7884616023, skewness=masked_array(data=16.90823148,
             mask=False,
       fill_value=1e+20), kurtosis=284.5766560561788)
</pre></div>
</div>
</div>
</div>
<p>With trimmed mean, we can define the limits to the values of a variable from which the mean is calculated. There are <strong>trimmed</strong> versions for many other statistics too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">tmean</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;ROE (%)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span><span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16.574942965779467
</pre></div>
</div>
</div>
</div>
<p>Standard error of the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1361037857496699
</pre></div>
</div>
</div>
</div>
<p>Bayesian confidence intervals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">bayes_mvs</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Mean(statistic=2.3185433333333334, minmax=(2.0939767460292535, 2.5431099206374133)),
 Variance(statistic=5.594694856689113, minmax=(4.8824225544086, 6.392205754936627)),
 Std_dev(statistic=2.3633205707178084, minmax=(2.2096204548312364, 2.528281185892231)))
</pre></div>
</div>
</div>
</div>
<p>Interquantile range</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.7075
</pre></div>
</div>
</div>
</div>
<p>The list of correlation functions is also extensive. The functions also return the p-value from the signficance test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_df</span> <span class="o">=</span> <span class="n">stat_df</span><span class="p">[[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">,</span><span class="s1">&#39;SG%A/SALES 5Y (%)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The output of SciPy is a bit ascetic. The first value is the correlation coefficient and the second value is the p-value.</p>
<p>Pearson’s correlation coefficient</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">],</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;SG%A/SALES 5Y (%)&#39;</span><span class="p">])</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-0.24627736138733555, 0.00013219335560399939)
</pre></div>
</div>
</div>
</div>
<p>Spearman’s rank correlation coefficient</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">],</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;SG%A/SALES 5Y (%)&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SpearmanrResult(correlation=-0.14763581111674745, pvalue=0.02330319841753993)
</pre></div>
</div>
</div>
</div>
<p>There are many statistical tests included. Let’s divide our data to US companies and others to test the Scipy <strong>ttest()</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">us_df</span> <span class="o">=</span> <span class="n">stat_df</span><span class="p">[</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;IBES COUNTRY CODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;  US&#39;</span><span class="p">]</span> <span class="c1"># US</span>
<span class="n">nonus_df</span> <span class="o">=</span> <span class="n">stat_df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">stat_df</span><span class="p">[</span><span class="s1">&#39;IBES COUNTRY CODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;US&#39;</span><span class="p">)]</span> <span class="c1"># Non-US (notice the tilde symbol)</span>
</pre></div>
</div>
</div>
</div>
<p>This test assumes equal variance for both groups. The result implies that the (mean) dividend yield is higher in non-US companies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">us_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">],</span><span class="n">nonus_df</span><span class="p">[</span><span class="s1">&#39;DIV. YIELD&#39;</span><span class="p">],</span><span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ttest_indResult(statistic=-2.53873471415298, pvalue=0.011463548320684814)
</pre></div>
</div>
</div>
</div>
<p>There are functions for many other statistical tasks, like transformations, statistical distnaces, contigency tables. Check the Scipy homepage for more details.</p>
</section>
<section id="time-series">
<h2><span class="section-number">7.5. </span>Time series<a class="headerlink" href="#time-series" title="Permalink to this heading">#</a></h2>
<p>Time series analysis is an important topic in accounting. Python and Pandas has many functions for time series analysis. Time series data has usually fixed frequency, which means that data points occur at regular intervals. Time series can also be irregular, which can potentially make the analysis very difficult. Luckily, Python/Pandas simplifies things considerably.</p>
<section id="datetime">
<h3><span class="section-number">7.5.1. </span>Datetime<a class="headerlink" href="#datetime" title="Permalink to this heading">#</a></h3>
<p>Python has modules for date/time -handling by default, the most important being <strong>datetime</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="c1"># Date and time now</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2021, 3, 2, 10, 59, 43, 813494)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">second</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>44
</pre></div>
</div>
</div>
</div>
<p>You can calculate with the datetime objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">difference</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">difference</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.timedelta(days=737707)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">difference</span><span class="o">.</span><span class="n">days</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>737707
</pre></div>
</div>
</div>
</div>
<p>You can use <strong>timedelta</strong> to transform datetime objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first argument of timedelta is days.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date1</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2020, 1, 13, 0, 0)
</pre></div>
</div>
</div>
</div>
<p>Dates can be easily turned into string using the Python <strong>str()</strong> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="n">date1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2020-01-01 00:00:00&#39;
</pre></div>
</div>
</div>
</div>
<p>If you want to specify the date/time -format, you can use the strftime method of the datetime object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date2</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date2</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y - %m - </span><span class="si">%d</span><span class="s1"> : Week number %W&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;2015 - 03 - 18 : Week number 11&#39;
</pre></div>
</div>
</div>
</div>
<p>There is also an opposite method, <strong>strptime()</strong>, that turns a string into a datetime object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_data</span> <span class="o">=</span> <span class="s1">&#39;Year: 2012, Month: 10, Day: 12&#39;</span>

<span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">sample_data</span><span class="p">,</span> <span class="s1">&#39;Year: %Y, Month: %m, Day: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2012, 10, 12, 0, 0)
</pre></div>
</div>
</div>
</div>
<p>As you can see, you can strip the date information efficiently, if you know the the format of your date-string. There is also a great non-standard library that can be used to automatically strip date from many different date representations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Dec 8, 2009&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2009, 12, 8, 0, 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;11th of March, 2018&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2018, 3, 11, 0, 0)
</pre></div>
</div>
</div>
</div>
<p>You have to be careful with the following syntax.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;8/3/2015&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2015, 8, 3, 0, 0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;8/3/2015&#39;</span><span class="p">,</span><span class="n">dayfirst</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>datetime.datetime(2015, 3, 8, 0, 0)
</pre></div>
</div>
</div>
</div>
<p>The most important Pandas function for handling dates is <strong>to_datetime</strong>. We will see many applications of it in the following, but let’s first load an interesting time series.</p>
<p>The data contains accountants and auditors as a percent of the US labor force 1850 to 2016. This data is a little bit difficult, because the frequency is irregular. The first datapoints have a ten-year interval, and from 2000 onwards the interval is one year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span> <span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://vincentarelbundock.github.io/Rdatasets/csv/Ecdat/AccountantsAuditorsPct.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>dat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1860</td>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1870</td>
      <td>0.000142</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1880</td>
      <td>0.000150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1900</td>
      <td>0.000414</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">:</span><span class="s1">&#39;Year&#39;</span><span class="p">},</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Correct the name of the year variable</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>dat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850</td>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1860</td>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1870</td>
      <td>0.000142</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1880</td>
      <td>0.000150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1900</td>
      <td>0.000414</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With <strong>to_datetime</strong>, we can transform the years as datetime objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">times_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;%Y&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>dat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1850-01-01</td>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1860-01-01</td>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1870-01-01</td>
      <td>0.000142</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1880-01-01</td>
      <td>0.000150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1900-01-01</td>
      <td>0.000414</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Plotting and other things are much easier, if we set the dates as the index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There is a special object in Pandas for indices that have datetime objects, <strong>Datetimeindex</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">times_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.datetimes.DatetimeIndex
</pre></div>
</div>
</div>
</div>
<p>You can pick up the timestamp from an index value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_stamp</span> <span class="o">=</span> <span class="n">times_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_stamp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Timestamp(&#39;1940-01-01 00:00:00&#39;)
</pre></div>
</div>
</div>
</div>
<p>Now you can pick up values with these timestamps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">time_stamp</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dat    0.0046
Name: 1940-01-01 00:00:00, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Actually, you can also use date strings. Pandas will automatically transform it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1980&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dat</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1980-01-01</th>
      <td>0.008672</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Slicing works also.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2010&#39;</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dat</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2010-01-01</th>
      <td>0.013358</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>0.013382</td>
    </tr>
    <tr>
      <th>2012-01-01</th>
      <td>0.013687</td>
    </tr>
    <tr>
      <th>2013-01-01</th>
      <td>0.013253</td>
    </tr>
    <tr>
      <th>2014-01-01</th>
      <td>0.012542</td>
    </tr>
    <tr>
      <th>2015-01-01</th>
      <td>0.012652</td>
    </tr>
    <tr>
      <th>2016-01-01</th>
      <td>0.012518</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Plotting is easy with the Pandas’ built-in functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e39b293439eab19212b6893ce68b9f36dddf0772bc1e65d60d0efa211dc7bb18.png" src="_images/e39b293439eab19212b6893ce68b9f36dddf0772bc1e65d60d0efa211dc7bb18.png" />
</div>
</div>
<p>Everything works nicely, although we have a dataset with irregular frequency.</p>
<p>If we want, we can transform the series into a fixed frequency time series using <strong>resample</strong>..</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dat</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1850-01-01</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1860-01-01</th>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>1870-01-01</th>
      <td>0.000142</td>
    </tr>
    <tr>
      <th>1880-01-01</th>
      <td>0.000150</td>
    </tr>
    <tr>
      <th>1900-01-01</th>
      <td>0.000414</td>
    </tr>
    <tr>
      <th>1910-01-01</th>
      <td>0.000908</td>
    </tr>
    <tr>
      <th>1920-01-01</th>
      <td>0.002922</td>
    </tr>
    <tr>
      <th>1930-01-01</th>
      <td>0.003971</td>
    </tr>
    <tr>
      <th>1940-01-01</th>
      <td>0.004600</td>
    </tr>
    <tr>
      <th>1950-01-01</th>
      <td>0.006363</td>
    </tr>
    <tr>
      <th>1960-01-01</th>
      <td>0.006152</td>
    </tr>
    <tr>
      <th>1970-01-01</th>
      <td>0.007486</td>
    </tr>
    <tr>
      <th>1980-01-01</th>
      <td>0.008672</td>
    </tr>
    <tr>
      <th>1990-01-01</th>
      <td>0.011992</td>
    </tr>
    <tr>
      <th>2000-01-01</th>
      <td>0.012393</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Using yearly resampling adds missing values, because for most of the interval we are increasing the frequency.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dat</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1850-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1851-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1852-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1853-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1854-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1855-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1856-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1857-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1858-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1859-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1860-12-31</th>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>1861-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1862-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1863-12-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1864-12-31</th>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9fd5ca3e29885fc6128a8fe0c1466d49202040452ef5afec2b55db30e54f6b5d.png" src="_images/9fd5ca3e29885fc6128a8fe0c1466d49202040452ef5afec2b55db30e54f6b5d.png" />
</div>
</div>
<p>If we want, we can fill the missing values with <strong>fillna</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dat</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1850-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1851-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1852-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1853-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1854-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1855-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1856-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1857-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1858-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1859-12-31</th>
      <td>0.000133</td>
    </tr>
    <tr>
      <th>1860-12-31</th>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>1861-12-31</th>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>1862-12-31</th>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>1863-12-31</th>
      <td>0.000147</td>
    </tr>
    <tr>
      <th>1864-12-31</th>
      <td>0.000147</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">times_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/958ef6c57f33269cc7f88161e74760ce8e4af821b7fd2911a65acbd60f002744.png" src="_images/958ef6c57f33269cc7f88161e74760ce8e4af821b7fd2911a65acbd60f002744.png" />
</div>
</div>
<p>We can also decrease the frequency and decide how the original data is aggregated. Let’s simulate a stock price using a random walk series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2010-06-1&#39;</span><span class="p">,</span> <span class="n">periods</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">temp_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>

<span class="n">temp_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_np</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">temp_np</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">sample_period</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2010-06-01    1
2010-06-02    2
2010-06-03    1
2010-06-04    2
2010-06-05    1
2010-06-06    2
2010-06-07    3
2010-06-08    4
2010-06-09    5
2010-06-10    6
2010-06-11    5
2010-06-12    4
2010-06-13    5
2010-06-14    6
2010-06-15    5
Freq: D, dtype: int32
</pre></div>
</div>
</div>
</div>
<p>Resample as weekly data where the daily values are aggregated together with <strong>mean()</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2010-06-06    1.500000
2010-06-13    4.571429
2010-06-20    5.857143
2010-06-27    7.142857
2010-07-04    5.285714
                ...   
2011-09-18   -3.142857
2011-09-25   -4.142857
2011-10-02   -4.285714
2011-10-09   -5.285714
2011-10-16   -3.500000
Freq: W-SUN, Length: 72, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rwalk_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b894e2f0490763d04f72640df08da9216c42f6066ca90d9460979c408f02c0b5.png" src="_images/b894e2f0490763d04f72640df08da9216c42f6066ca90d9460979c408f02c0b5.png" />
</div>
</div>
<p>A very common way to aggregate data in finance, is open-high-low-close.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ohlc</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-09-18</th>
      <td>-3</td>
      <td>-2</td>
      <td>-5</td>
      <td>-5</td>
    </tr>
    <tr>
      <th>2011-09-25</th>
      <td>-4</td>
      <td>-2</td>
      <td>-6</td>
      <td>-2</td>
    </tr>
    <tr>
      <th>2011-10-02</th>
      <td>-3</td>
      <td>-3</td>
      <td>-5</td>
      <td>-5</td>
    </tr>
    <tr>
      <th>2011-10-09</th>
      <td>-6</td>
      <td>-4</td>
      <td>-6</td>
      <td>-4</td>
    </tr>
    <tr>
      <th>2011-10-16</th>
      <td>-3</td>
      <td>-3</td>
      <td>-4</td>
      <td>-4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ohlc</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/40f2cc429fd1daa5e319596d77e59afb237643ad1e4f9dd59e568a622f2578e3.png" src="_images/40f2cc429fd1daa5e319596d77e59afb237643ad1e4f9dd59e568a622f2578e3.png" />
</div>
</div>
<p>A very important topic in time series analysis is filtering with moving windows.</p>
<p>With rolling, we can easily create a moving average from a time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rwalk_df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/257b5f2f54027ead3eda758e705f9256633c3bb9d852ec0dcc9198a76e614f89.png" src="_images/257b5f2f54027ead3eda758e705f9256633c3bb9d852ec0dcc9198a76e614f89.png" />
</div>
</div>
<p>As you can see, by default the function calculates the average only when all values are awailable, and therefore, there are missing values at the beginning. You can avoid this with the <strong>min_periods</strong> parameter. With the <strong>center</strong> parameter, you can remove the lag in the average:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rwalk_df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d1eeda5ae48280b97f4f3bc469c48da3bbb9df915bb3febbf5908ac7fccc72dc.png" src="_images/d1eeda5ae48280b97f4f3bc469c48da3bbb9df915bb3febbf5908ac7fccc72dc.png" />
</div>
</div>
<p>Very often, the moving average is calculated using an exponentially weighted filter. Pandas has the <strong>ewm</strong> function for that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rwalk_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rwalk_df</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">rwalk_df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/28c2fcca6bd0deb3f5a4104afac99f45881adc3794ab3c601398e4f927c67996.png" src="_images/28c2fcca6bd0deb3f5a4104afac99f45881adc3794ab3c601398e4f927c67996.png" />
</div>
</div>
<p>With <strong>rolling</strong>, we can even calculate correlations from aggregates. Let’s load a more interesting data for that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://vincentarelbundock.github.io/Rdatasets/csv/datasets/EuStockMarkets.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>freg=’B’</strong> means business day frequency. Here is the full list aliases for frequencies: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases">Offset aliases</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1991-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1998-02-16&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f70ee3071377eebf3aa1a89665b5b52406efa00d89a073fae857c17f04be221d.png" src="_images/f70ee3071377eebf3aa1a89665b5b52406efa00d89a073fae857c17f04be221d.png" />
</div>
</div>
<p>The returns of stock indices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_ret_df</span> <span class="o">=</span> <span class="n">euro_df</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_ret_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7cca20704a934d62222455b83b24ce69e47728695e77bb998a8d0601ac7362d5.png" src="_images/7cca20704a934d62222455b83b24ce69e47728695e77bb998a8d0601ac7362d5.png" />
</div>
</div>
<p>The correlation between DAX and the other indices calculated from a 64-day window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_ret_df</span><span class="p">[</span><span class="s1">&#39;DAX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">euro_ret_df</span><span class="p">[[</span><span class="s1">&#39;SMI&#39;</span><span class="p">,</span><span class="s1">&#39;CAC&#39;</span><span class="p">,</span><span class="s1">&#39;FTSE&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/d54a75c9840c155c72032ead7d57da8fc47ef7c38b2b2c26b1f86198b5990a30.png" src="_images/d54a75c9840c155c72032ead7d57da8fc47ef7c38b2b2c26b1f86198b5990a30.png" />
</div>
</div>
<p>With <strong>apply</strong>, you can even define your own functions to calculate an aggregate value from windows. The following calculates an interquartile range from the window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inter_quart</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">0.75</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">euro_ret_df</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">inter_quart</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/266b6b792c0bea60755d0236f1e2125375795249887c75acaf500ecf28907223.png" src="_images/266b6b792c0bea60755d0236f1e2125375795249887c75acaf500ecf28907223.png" />
</div>
</div>
<p>Time series analysis in Pandas is a vast topic, and we have only scratched a surface. If you want to learn more, check <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html">pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html</a></p>
</section>
<section id="arima-models">
<h3><span class="section-number">7.5.2. </span>ARIMA models<a class="headerlink" href="#arima-models" title="Permalink to this heading">#</a></h3>
<p>In this section, I will shortly introduce ARIMA models. They assume that in a time series the present valua depends on the previous values (AR = autoregressive). They also include moving averages (MA). “I” in the name means that the modeled time series is the n:th difference of the original time series (I = integrated):</p>
<p>Let’s build an ARIMA model for the euro dataset.</p>
<p>One essential tool to assess how the data depends on the previous values and select a model that reflects this is the sample autocorrelation function. The sample ACF will provide us with an estimate of the ACF and suggests a time series model suitable for representing the data’s dependence. For example, a sample ACF close to zero for all nonzero lags suggests that an appropriate model for the data might be iid noise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
</pre></div>
</div>
</div>
</div>
<p>Lags 1, 6, 11 and 13 appear to be statistically signficant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">euro_ret_df</span><span class="p">[</span><span class="s1">&#39;FTSE&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01d1a35d2dd70d7e926f628c82ec27f53b530b977195a651762fa4bfd79709d4.png" src="_images/01d1a35d2dd70d7e926f628c82ec27f53b530b977195a651762fa4bfd79709d4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s separate the last 100 observations from the data for testing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">euro_df</span><span class="p">[</span><span class="s1">&#39;FTSE&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">euro_df</span><span class="p">[</span><span class="s1">&#39;FTSE&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">100</span><span class="p">:]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Based on the ACF plot, 13 lags, integrated=1 (first difference of the original series) and first order moving average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>SARIMAX Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>y</td>        <th>  No. Observations:  </th>   <td>1760</td>   
</tr>
<tr>
  <th>Model:</th>            <td>ARIMA(13, 1, 1)</td> <th>  Log Likelihood     </th> <td>-8345.813</td>
</tr>
<tr>
  <th>Date:</th>            <td>Wed, 24 Feb 2021</td> <th>  AIC                </th> <td>16721.627</td>
</tr>
<tr>
  <th>Time:</th>                <td>14:01:39</td>     <th>  BIC                </th> <td>16803.714</td>
</tr>
<tr>
  <th>Sample:</th>                  <td>0</td>        <th>  HQIC               </th> <td>16751.964</td>
</tr>
<tr>
  <th></th>                      <td> - 1760</td>     <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>        <td>opg</td>       <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ar.L1</th>  <td>    0.3538</td> <td>    0.359</td> <td>    0.985</td> <td> 0.325</td> <td>   -0.350</td> <td>    1.058</td>
</tr>
<tr>
  <th>ar.L2</th>  <td>   -0.0475</td> <td>    0.043</td> <td>   -1.097</td> <td> 0.273</td> <td>   -0.132</td> <td>    0.037</td>
</tr>
<tr>
  <th>ar.L3</th>  <td>    0.0187</td> <td>    0.019</td> <td>    0.975</td> <td> 0.330</td> <td>   -0.019</td> <td>    0.056</td>
</tr>
<tr>
  <th>ar.L4</th>  <td>   -0.0326</td> <td>    0.021</td> <td>   -1.531</td> <td> 0.126</td> <td>   -0.074</td> <td>    0.009</td>
</tr>
<tr>
  <th>ar.L5</th>  <td>   -0.0324</td> <td>    0.022</td> <td>   -1.461</td> <td> 0.144</td> <td>   -0.076</td> <td>    0.011</td>
</tr>
<tr>
  <th>ar.L6</th>  <td>   -0.0331</td> <td>    0.023</td> <td>   -1.461</td> <td> 0.144</td> <td>   -0.078</td> <td>    0.011</td>
</tr>
<tr>
  <th>ar.L7</th>  <td>   -0.0292</td> <td>    0.028</td> <td>   -1.055</td> <td> 0.292</td> <td>   -0.084</td> <td>    0.025</td>
</tr>
<tr>
  <th>ar.L8</th>  <td>    0.0376</td> <td>    0.025</td> <td>    1.504</td> <td> 0.133</td> <td>   -0.011</td> <td>    0.087</td>
</tr>
<tr>
  <th>ar.L9</th>  <td>    0.0543</td> <td>    0.023</td> <td>    2.414</td> <td> 0.016</td> <td>    0.010</td> <td>    0.098</td>
</tr>
<tr>
  <th>ar.L10</th> <td>   -0.0099</td> <td>    0.029</td> <td>   -0.344</td> <td> 0.731</td> <td>   -0.066</td> <td>    0.046</td>
</tr>
<tr>
  <th>ar.L11</th> <td>    0.0572</td> <td>    0.019</td> <td>    2.956</td> <td> 0.003</td> <td>    0.019</td> <td>    0.095</td>
</tr>
<tr>
  <th>ar.L12</th> <td>   -0.0438</td> <td>    0.029</td> <td>   -1.498</td> <td> 0.134</td> <td>   -0.101</td> <td>    0.014</td>
</tr>
<tr>
  <th>ar.L13</th> <td>    0.0529</td> <td>    0.020</td> <td>    2.594</td> <td> 0.009</td> <td>    0.013</td> <td>    0.093</td>
</tr>
<tr>
  <th>ma.L1</th>  <td>   -0.2452</td> <td>    0.358</td> <td>   -0.684</td> <td> 0.494</td> <td>   -0.947</td> <td>    0.457</td>
</tr>
<tr>
  <th>sigma2</th> <td>  773.8240</td> <td>   16.100</td> <td>   48.063</td> <td> 0.000</td> <td>  742.269</td> <td>  805.380</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Ljung-Box (L1) (Q):</th>     <td>0.02</td> <th>  Jarque-Bera (JB):  </th> <td>1049.11</td>
</tr>
<tr>
  <th>Prob(Q):</th>                <td>0.87</td> <th>  Prob(JB):          </th>  <td>0.00</td>  
</tr>
<tr>
  <th>Heteroskedasticity (H):</th> <td>2.90</td> <th>  Skew:              </th>  <td>0.05</td>  
</tr>
<tr>
  <th>Prob(H) (two-sided):</th>    <td>0.00</td> <th>  Kurtosis:          </th>  <td>6.78</td>  
</tr>
</table><br/><br/>Warnings:<br/>[1] Covariance matrix calculated using the outer product of gradients (complex-step).</div></div>
</div>
<p>The residuals of the model (difference between the prediction and the true value).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9bd72d6a9e6213005ad3e22338c4006cc7896c2dee264f7b06d05ad01511ee27.png" src="_images/9bd72d6a9e6213005ad3e22338c4006cc7896c2dee264f7b06d05ad01511ee27.png" />
</div>
</div>
<p>The distribution of the residuals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5092379155229d4b9bfc6ad0a8a959728e6b61fde7c4330d53a554db2a879058.png" src="_images/5092379155229d4b9bfc6ad0a8a959728e6b61fde7c4330d53a554db2a879058.png" />
</div>
</div>
<p>Prediction 100 steps forward and comparison to real values. As you can see from the plot below, the prediction is heavily based on the current value. The best prediction for tomorrow is the current value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_set</span> <span class="o">=</span> <span class="n">train_set</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_set</span><span class="p">)):</span>
    <span class="n">model</span><span class="o">=</span><span class="n">ARIMA</span><span class="p">(</span><span class="n">temp_set</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">forecast</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
    <span class="n">temp_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_set</span><span class="p">[</span><span class="n">step</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6e79465c7aa01cbdd285b0745d724140d6e02e204857e601507b68cd3fd379dd.png" src="_images/6e79465c7aa01cbdd285b0745d724140d6e02e204857e601507b68cd3fd379dd.png" />
</div>
</div>
<p>A comprehensive list of model diagnostics can be plotted with <strong>plot_diagnostics</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_fit</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7e63a85a05647460d90e844cd7a23412297058784de1220d2b0a7504b3b4e43f.png" src="_images/7e63a85a05647460d90e844cd7a23412297058784de1220d2b0a7504b3b4e43f.png" />
<img alt="_images/7e63a85a05647460d90e844cd7a23412297058784de1220d2b0a7504b3b4e43f.png" src="_images/7e63a85a05647460d90e844cd7a23412297058784de1220d2b0a7504b3b4e43f.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="5_Visualisation_with_Python.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">6. </span>Visualisations with Python</p>
      </div>
    </a>
    <a class="right-next"
       href="7.1_ML_for_structured_data-classification.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Machine learning for structured data - Classification</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics-with-pandas">7.1. Descriptive statistics with Pandas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#probability-and-statistics-functions">7.2. Probability and statistics functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-analysis-with-statsmodels">7.3. Statistical analysis with statsmodels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-analysis-with-scipy-stats">7.4. Statistical analysis with scipy.stats</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series">7.5. Time series</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datetime">7.5.1. Datetime</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-models">7.5.2. ARIMA models</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mikko Ranta
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>